<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
                   "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">
<!-- lifted from troff+man by doclifter -->
<refentry>
<refmeta>
<refentrytitle>IPSEC.CONF</refentrytitle>
<manvolnum>5</manvolnum>
<refmiscinfo class='date'>26 Nov 2001</refmiscinfo>
</refmeta>
<refnamediv id='name'>
<refname>ipsec.conf</refname>
<refpurpose>IPsec configuration and connections</refpurpose>
</refnamediv>
<!-- body begins here -->

<refsect1 id='description'><title>DESCRIPTION</title>
<para>The optional
<emphasis remap='I'>ipsec.conf</emphasis>
file
specifies most configuration and control information for the
Openswan IPsec subsystem.
(The major exception is secrets for authentication;
see
<citerefentry><refentrytitle>ipsec.secrets</refentrytitle><manvolnum>5</manvolnum></citerefentry>.)
Its contents are not security-sensitive
<emphasis remap='I'>unless</emphasis>
manual keying is being done for more than just testing,
in which case the encryption/authentication keys in the
descriptions for the manually-keyed connections are very sensitive
(and those connection descriptions
are probably best kept in a separate file,
via the include facility described below).</para>

<para>The file is a text file, consisting of one or more
<emphasis remap='I'>sections</emphasis>.
White space followed by
<emphasis remap='B'>#</emphasis>
followed by anything to the end of the line
is a comment and is ignored,
as are empty lines which are not within a section.</para>

<para>A line which contains
<emphasis remap='B'>include</emphasis>
and a file name, separated by white space,
is replaced by the contents of that file,
preceded and followed by empty lines.
If the file name is not a full pathname,
it is considered to be relative to the directory containing the
including file.
Such inclusions can be nested.
Only a single filename may be supplied, and it may not contain white space,
but it may include shell wildcards (see
<citerefentry><refentrytitle>sh</refentrytitle><manvolnum>1</manvolnum></citerefentry>);
for example:</para>

<para><emphasis remap='B'>include</emphasis>
<emphasis remap='B'>ipsec.*.conf</emphasis></para>

<para>The intention of the include facility is mostly to permit keeping
information on connections, or sets of connections,
separate from the main configuration file.
This permits such connection descriptions to be changed,
copied to the other security gateways involved, etc.,
without having to constantly extract them from the configuration
file and then insert them back into it.
Note also the
<emphasis remap='B'>also</emphasis>
and
<emphasis remap='B'>alsoflip</emphasis>
parameters (described below) which permit splitting a single logical section
(e.g. a connection description) into several actual sections.</para>

<para>The first significant line of the file must specify the version
of this specification that it conforms to:</para>

<para><emphasis remap='B'>version 2</emphasis></para>

<para>A section
begins with a line of the form:</para>

<para><emphasis remap='I'>type</emphasis>
<emphasis remap='I'>name</emphasis></para>

<para>where
<emphasis remap='I'>type</emphasis>
indicates what type of section follows, and
<emphasis remap='I'>name</emphasis>
is an arbitrary name which distinguishes the section from others
of the same type.
(Names must start with a letter and may contain only
letters, digits, periods, underscores, and hyphens.)
All subsequent non-empty lines
which begin with white space are part of the section;
comments within a section must begin with white space too.
There may be only one section of a given type with a given name.</para>

<para>Lines within the section are generally of the form</para>

<para>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<emphasis remap='I'>parameter</emphasis><emphasis remap='B'>=</emphasis><emphasis remap='I'>value</emphasis></para>

<para>(note the mandatory preceding white space).
There can be white space on either side of the
<emphasis remap='B'>=</emphasis>.
Parameter names follow the same syntax as section names,
and are specific to a section type.
Unless otherwise explicitly specified,
no parameter name may appear more than once in a section.</para>

<para>An empty
<emphasis remap='I'>value</emphasis>
stands for the system default value (if any) of the parameter,
i.e. it is roughly equivalent to omitting the parameter line entirely.
A
<emphasis remap='I'>value</emphasis>
may contain white space only if the entire
<emphasis remap='I'>value</emphasis>
is enclosed in double quotes (<emphasis remap='B'>"</emphasis>);
a
<emphasis remap='I'>value</emphasis>
cannot itself contain a double quote,
nor may it be continued across more than one line.</para>

<para>Numeric values are specified to be either an &ldquo;integer&rdquo;
(a sequence of digits) or a &ldquo;decimal number&rdquo;
(sequence of digits optionally followed by `.' and another sequence of digits).</para>

<para>There is currently one parameter which is available in any type of
section:</para>
<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='B'>also</emphasis></term>
  <listitem>
<para>the value is a section name;
the parameters of that section are appended to this section,
as if they had been written as part of it.
The specified section must exist, must follow the current one,
and must have the same section type.
(Nesting is permitted,
and there may be more than one
<emphasis remap='B'>also</emphasis>
in a single section,
although it is forbidden to append the same section more than once.)
This allows, for example, keeping the encryption keys
for a connection in a separate file
from the rest of the description, by using both an
<emphasis remap='B'>also</emphasis>
parameter and an
<emphasis remap='B'>include</emphasis>
line.
(Caution, see BUGS below for some restrictions.)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>alsoflip</emphasis></term>
  <listitem>
<para>can be used in a
<emphasis remap='B'>conn</emphasis>
section.
It acts like an
<emphasis remap='B'>also</emphasis>
that flips the referenced section's entries left-for-right.</para>
  </listitem>
  </varlistentry>
</variablelist>

<para>Parameter names beginning with
<emphasis remap='B'>x-</emphasis>
(or
<emphasis remap='B'>X-</emphasis>,
or
<emphasis remap='B'>x_</emphasis>,
or
<emphasis remap='B'>X_</emphasis>)
are reserved for user extensions and will never be assigned meanings
by IPsec.
Parameters with such names must still observe the syntax rules
(limits on characters used in the name;
no white space in a non-quoted value;
no newlines or double quotes within the value).
All other as-yet-unused parameter names are reserved for future IPsec
improvements.</para>

<para>A section with name
<emphasis remap='B'>%default</emphasis>
specifies defaults for sections of the same type.
For each parameter in it,
any section of that type which does not have a parameter of the same name
gets a copy of the one from the
<emphasis remap='B'>%default</emphasis>
section.
There may be multiple
<emphasis remap='B'>%default</emphasis>
sections of a given type,
but only one default may be supplied for any specific parameter name,
and all
<emphasis remap='B'>%default</emphasis>
sections of a given type must precede all non-<emphasis remap='B'>%default</emphasis>
sections of that type.
<emphasis remap='B'>%default</emphasis>
sections may not contain
<emphasis remap='B'>also</emphasis>
or
<emphasis remap='B'>alsoflip</emphasis>
parameters.</para>

<para>Currently there are two types of section:
a
<emphasis remap='B'>config</emphasis>
section specifies general configuration information for IPsec,
while a
<emphasis remap='B'>conn</emphasis>
section specifies an IPsec connection.</para>
</refsect1>

<refsect1 id='conn_sections'><title>CONN SECTIONS</title>
<para>A
<emphasis remap='B'>conn</emphasis>
section contains a
<emphasis remap='I'>connection specification</emphasis>,
defining a network connection to be made using IPsec.
The name given is arbitrary, and is used to identify the connection to
<citerefentry><refentrytitle>ipsec_auto</refentrytitle><manvolnum>8</manvolnum></citerefentry>
and
<citerefentry><refentrytitle>ipsec_manual</refentrytitle><manvolnum>8</manvolnum></citerefentry>.
Here's a simple example:</para>

<!-- .ne 10 -->
<literallayout remap='.nf'>
<!-- .ta 1c -->
<emphasis remap='B'>
conn snt
	left=10.11.11.1
	leftsubnet=10.0.1.0/24
	leftnexthop=172.16.55.66
	leftsourceip=10.0.1.1
	right=192.168.22.1
	rightsubnet=10.0.2.0/24
	rightnexthop=172.16.88.99
	rightsourceip=10.0.2.1
	keyingtries=%forever
</emphasis>
</literallayout> <!-- .fi -->

<para>A note on terminology...
In automatic keying, there are two kinds of communications going on:
transmission of user IP packets, and gateway-to-gateway negotiations for
keying, rekeying, and general control.
The data path (a set of &ldquo;IPsec SAs&rdquo;) used for user packets is herein
referred to as the &ldquo;connection&rdquo;;
the path used for negotiations (built with &ldquo;ISAKMP SAs&rdquo;) is referred to as
the &ldquo;keying channel&rdquo;.</para>

<para>To avoid trivial editing of the configuration file to suit it to each system
involved in a connection,
connection specifications are written in terms of
<emphasis remap='I'>left</emphasis>
and
<emphasis remap='I'>right</emphasis>
participants,
rather than in terms of local and remote.
Which participant is considered
<emphasis remap='I'>left</emphasis>
or
<emphasis remap='I'>right</emphasis>
is arbitrary;
IPsec figures out which one it is being run on based on internal information.
This permits using identical connection specifications on both ends.
There are cases where there is no symmetry; a good convention is to
use
<emphasis remap='I'>left</emphasis>
for the local side and
<emphasis remap='I'>right</emphasis>
for the remote side (the first letters are a good mnemonic).</para>

<para>Many of the parameters relate to one participant or the other;
only the ones for
<emphasis remap='I'>left</emphasis>
are listed here, but every parameter whose name begins with
<emphasis remap='B'>left</emphasis>
has a
<emphasis remap='B'>right</emphasis>
counterpart,
whose description is the same but with
<emphasis remap='B'>left</emphasis>
and
<emphasis remap='B'>right</emphasis>
reversed.</para>

<para>Parameters are optional unless marked &ldquo;(required)&rdquo;;
a parameter required for manual keying need not be included for
a connection which will use only automatic keying, and vice versa.</para>

<refsect2 id='conn_parameters__general'><title>CONN PARAMETERS:  GENERAL</title>
<para>The following parameters are relevant to both automatic and manual keying.
Unless otherwise noted,
for a connection to work,
in general it is necessary for the two ends to agree exactly
on the values of these parameters.</para>
<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='B'>type</emphasis></term>
  <listitem>
<para>the type of the connection; currently the accepted values
are
<emphasis remap='B'>tunnel</emphasis>
(the default)
signifying a host-to-host, host-to-subnet, or subnet-to-subnet tunnel;
<emphasis remap='B'>transport</emphasis>,
signifying host-to-host transport mode;
<emphasis remap='B'>passthrough</emphasis>,
signifying that no IPsec processing should be done at all;
<emphasis remap='B'>drop</emphasis>,
signifying that packets should be discarded; and
<emphasis remap='B'>reject</emphasis>,
signifying that packets should be discarded and a diagnostic ICMP returned.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>left</emphasis></term>
  <listitem>
<para>(required)
the IP address of the left participant's public-network interface,
in any form accepted by
<citerefentry><refentrytitle>ipsec_ttoaddr</refentrytitle><manvolnum>3</manvolnum></citerefentry>
or one of several magic values.
If it is
<emphasis remap='B'>%defaultroute</emphasis>,
and
the
<emphasis remap='B'>config</emphasis>
<emphasis remap='B'>setup</emphasis>
section's,
<emphasis remap='B'>interfaces</emphasis>
specification contains
<emphasis remap='B'>%defaultroute,</emphasis>
<emphasis remap='B'>left</emphasis>
will be filled in automatically with the local address
of the default-route interface (as determined at IPsec startup time);
this also overrides any value supplied for
<emphasis remap='B'>leftnexthop</emphasis>.
(Either
<emphasis remap='B'>left</emphasis>
or
<emphasis remap='B'>right</emphasis>
may be
<emphasis remap='B'>%defaultroute</emphasis>,
but not both.)
The value
<emphasis remap='B'>%any</emphasis>
signifies an address to be filled in (by automatic keying) during
negotiation.
The value
<emphasis remap='B'>%opportunistic</emphasis>
signifies that both
<emphasis remap='B'>left</emphasis>
and
<emphasis remap='B'>leftnexthop</emphasis>
are to be filled in (by automatic keying) from DNS data for
<emphasis remap='B'>left</emphasis>'s
client.
The values
<emphasis remap='B'>%group</emphasis>
and
<emphasis remap='B'>%opportunisticgroup</emphasis>
makes this a policy group conn: one that will be instantiated
into a regular or opportunistic conn for each CIDR block listed in the
policy group file with the same name as the conn.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftsubnet</emphasis></term>
  <listitem>
<para>private subnet behind the left participant, expressed as
<emphasis remap='I'>network</emphasis><emphasis remap='B'>/</emphasis><emphasis remap='I'>netmask</emphasis>
(actually, any form acceptable to
<citerefentry><refentrytitle>ipsec_ttosubnet</refentrytitle><manvolnum>3</manvolnum></citerefentry>);
if omitted, essentially assumed to be <emphasis remap='I'>left</emphasis><filename>/32</filename>,
signifying that the left end of the connection goes to the left participant only. If the global option
<emphasis remap='I'>virtual_private</emphasis> has been set, the special keyword <emphasis remap='I'>vhost:%priv</emphasis>
can be used to designate the allowed NAT'ed networks this option can take. If one wants to support both the
allowed virtual_private networks as well as non-NAT'ed connection, this subnet option can be set
to <emphasis remap='I'>rightsubnet=vhost:%priv, %no</emphasis>. The special value <emphasis remap='I'>%priv</emphasis>
will be filled in with the network ranges specified in the global option <emphasis remap='I'>virtual_private=</emphasis>
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftnexthop</emphasis></term>
  <listitem>
<para>next-hop gateway IP address for the left participant's connection
to the public network;
defaults to
<emphasis remap='B'>%direct</emphasis>
(meaning
<emphasis remap='I'>right</emphasis>).
If the value is to be overridden by the
<emphasis remap='B'>left=%defaultroute</emphasis>
method (see above),
an explicit value must
<emphasis remap='I'>not</emphasis>
be given.
If that method is not being used,
but
<emphasis remap='B'>leftnexthop</emphasis>
is
<emphasis remap='B'>%defaultroute</emphasis>,
and
<emphasis remap='B'>interfaces=%defaultroute</emphasis>
is used in the
<emphasis remap='B'>config</emphasis>
<emphasis remap='B'>setup</emphasis>
section,
the next-hop gateway address of the default-route interface
will be used.
The magic value
<emphasis remap='B'>%direct</emphasis>
signifies a value to be filled in (by automatic keying)
with the peer's address.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftsourceip</emphasis></term>
  <listitem>
<para>the IP address for this host to use when transmitting a packet to the
other side of this link.  Relevant only locally, the other end need not agree.
This option is used to make the gateway itself use its internal IP, which is
part of the leftsubnet, to communicate to the rightsubnet or right. Otherwise,
it will use its <emphasis remap='B'>nearest</emphasis> IP address, which is
its public IP address. This option is mostly used when defining subnet-subnet
connections, so that the gateways can talk to each other and the subnet at
the other end, without the need to build additional host-subnet, subnet-host
and host-host tunnels.
</para>
  </listitem>
  </varlistentry>

  <varlistentry>
  <term><emphasis remap='B'>leftupdown</emphasis></term>
  <listitem>
<para>what &ldquo;updown&rdquo; script to run to adjust routing and/or firewalling
when the status of the connection
changes (default
<emphasis remap='B'>ipsec _updown</emphasis>).
May include positional parameters separated by white space
(although this requires enclosing the whole string in quotes);
including shell metacharacters is unwise.
See
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>
for details.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftfirewall</emphasis></term>
  <listitem>
<para>This option is obsolete and should not used anymore. </para>
  </listitem>
  </varlistentry>
</variablelist>
</refsect2>

<refsect2 id='conn_parameters__automatic_keying'><title>CONN PARAMETERS:  AUTOMATIC KEYING</title>
<para>The following parameters are relevant for automatic keying, the normal mode of operation
for IPsec. They are ignored in manual keying. Unless otherwise noted, for a connection to work,
in general it is necessary for the two ends to agree exactly on the values of these parameters.</para>
<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='B'>keyexchange</emphasis></term>
  <listitem>
<para>method of key exchange;
the default and currently the only accepted value is
<emphasis remap='B'>ike</emphasis></para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>auto</emphasis></term>
  <listitem>
<para>what operation, if any, should be done automatically at IPsec startup;
currently-accepted values are
<emphasis remap='B'>add</emphasis>
(signifying an
<emphasis remap='B'>ipsec auto</emphasis>
<option>--add</option>),
<emphasis remap='B'>route</emphasis>
(signifying that plus an
<emphasis remap='B'>ipsec auto</emphasis>
<option>--route</option>),
<emphasis remap='B'>start</emphasis>
(signifying that plus an
<emphasis remap='B'>ipsec auto</emphasis>
<option>--up</option>),
<emphasis remap='B'>manual</emphasis>
(signifying an
<emphasis remap='B'>ipsec</emphasis>
<emphasis remap='B'>manual</emphasis>
<option>--up</option>),
and
<emphasis remap='B'>ignore</emphasis>
(also the default) (signifying no automatic startup operation).
See the
<emphasis remap='B'>config</emphasis>
<emphasis remap='B'>setup</emphasis>
discussion below.
Relevant only locally, other end need not agree on it
(but in general, for an intended-to-be-permanent connection,
both ends should use
<emphasis remap='B'>auto=start</emphasis>
to ensure that any reboot causes immediate renegotiation). For roadwarrior
connections (<emphasis remap='B'>right=%any</emphasis>), it is not known
where the client will show up, so one has to use <emphasis remap='B'>auto=add</emphasis>
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>auth</emphasis></term>
  <listitem>
<para>whether authentication should be done as part of
ESP encryption, or separately using the AH protocol;
acceptable values are
<emphasis remap='B'>esp</emphasis>
(the default) and
<emphasis remap='B'>ah</emphasis>.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>authby</emphasis></term>
  <listitem>
<para>how the two security gateways should authenticate each other;
acceptable values are
<emphasis remap='B'>secret</emphasis>
for shared secrets,
<emphasis remap='B'>rsasig</emphasis>
for RSA digital signatures (the default),
<emphasis remap='B'>secret|rsasig</emphasis>
for either, and
<emphasis remap='B'>never</emphasis>
if negotiation is never to be attempted or accepted (useful for shunt-only conns).
Digital signatures are superior in every way to shared secrets.</para>
  </listitem>
  </varlistentry>

  <varlistentry>
  <term><emphasis remap='B'>ike</emphasis></term>
  <listitem>
<para>IKE encryption/authentication algorithm to be used
for the connection (phase 1 aka ISAKMP SA).  The format is
<emphasis remap='I'>"cipher-hash;modpgroup, cipher-hash;modpgroup, ..."</emphasis>
Any left out option will be filled in with all allowed default
options. Multiple proposals are seperated by a comma. If an
<emphasis remap='B'>ike=</emphasis>
line is specified, no other received proposals will be accepted.
Formerly there was a distinction (by using a <emphasis remap='B'>"!"</emphasis> symbol) between
"strict mode" or not. That mode has been obsoleted. If an <emphasis remap='B'>ike=</emphasis> option is
specified, the mode is always strict, meaning no other received proposals will be accepted.
Some examples are
<emphasis remap='B'>ike=3des-sha1,aes-sha1</emphasis>,
<emphasis remap='B'>ike=aes</emphasis>,
<emphasis remap='B'>ike=aes128-md5;modp2048</emphasis>,
<emphasis remap='B'>ike=3des-md5;modp1024,esp=aes-sha1;modp1536</emphasis> or
<emphasis remap='B'>ike=modp1536</emphasis>.
The options must be suitable as a value of
<citerefentry><refentrytitle>ipsec_spi</refentrytitle><manvolnum>8</manvolnum></citerefentry>'s
<option>--ike</option> option. The default is to use IKE, and to allow all combinations of:
<literallayout remap='.nf'><emphasis remap='B'>
		cipher:			3des or aes
		hash:			sha1 or md5
		pfsgroup (DHgroup):	modp1024 or modp1536
</emphasis></literallayout></para>
<para>
If Openswan was compiled with extra INSECURE and BROKEN options, then the des (1des) and null cipher, as
well as modp768 are available. This turns your VPN into a joke. Do not enable these options.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>esp</emphasis></term>
  <listitem>
<para>ESP encryption/authentication algorithm to be used for the connection (phase2 aka IPsec SA).
The format is identical to the <emphasis remap='B'>ike</emphasis> option listed above.
The options must be suitable as a value of
<citerefentry><refentrytitle>ipsec_spi</refentrytitle><manvolnum>8</manvolnum></citerefentry>'s
<option>--esp</option> option. The default is to use ESP. The default values are the same as for ike=
Note also that not all ciphers available to the kernel (eg through CryptoAPI) are necessarilly supported here.
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>ah</emphasis></term>
  <listitem>
<para>AH authentication algorithm to be used
for the connection, e.g here.
<emphasis remap='B'>hmac-md5</emphasis>
The options must be suitable as a value of
<citerefentry><refentrytitle>ipsec_spi</refentrytitle><manvolnum>8</manvolnum></citerefentry>'s
<option>--ah</option>
option.
The default is not to use AH. If for some (invalid) reason you still think you need AH, please
use esp with the null encryption cipher instead. Note also that not all ciphers available to the kernel (eg through CryptoAPI) are necessarilly supported here.
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftid</emphasis></term>
  <listitem>
<para>how
the left participant
should be identified for authentication;
defaults to
<emphasis remap='B'>left</emphasis>.
Can be an IP address (in any
<citerefentry><refentrytitle>ipsec_ttoaddr</refentrytitle><manvolnum>3</manvolnum></citerefentry>
syntax)
or a fully-qualified domain name preceded by
<emphasis remap='B'>@</emphasis>
(which is used as a literal string and not resolved).
The magic value
<emphasis remap='B'>%myid</emphasis>
stands for the current setting of <emphasis remap='I'>myid</emphasis>.
This is set in <emphasis remap='B'>config setup</emphasis> or by <citerefentry><refentrytitle>ipsec_whack</refentrytitle><manvolnum>8</manvolnum></citerefentry>), or, if not set,
it is the IP address in <emphasis remap='B'>%defaultroute</emphasis> (if that is supported by a TXT record in its reverse domain), or otherwise
it is the system's hostname (if that is supported by a TXT record in its forward domain), or otherwise it is undefined.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftrsasigkey</emphasis></term>
  <listitem>
<para>the left participant's
public key for RSA signature authentication,
in RFC 2537 format using
<citerefentry><refentrytitle>ipsec_ttodata</refentrytitle><manvolnum>3</manvolnum></citerefentry>
encoding.
The magic value
<emphasis remap='B'>%none</emphasis>
means the same as not specifying a value (useful to override a default).
The value
<emphasis remap='B'>%dnsondemand</emphasis>
(the default)
means the key is to be fetched from DNS at the time it is needed.
The value
<emphasis remap='B'>%dnsonload</emphasis>
means the key is to be fetched from DNS at the time
the connection description is read from
<emphasis remap='I'>ipsec.conf</emphasis>;
currently this will be treated as
<emphasis remap='B'>%none</emphasis>
if
<emphasis remap='B'>right=%any</emphasis>
or
<emphasis remap='B'>right=%opportunistic</emphasis>.
The value
<emphasis remap='B'>%dns</emphasis>
is currently treated as
<emphasis remap='B'>%dnsonload</emphasis>
but will change to
<emphasis remap='B'>%dnsondemand</emphasis>
in the future.
The identity used for the left participant
must be a specific host, not
<emphasis remap='B'>%any</emphasis>
or another magic value.
The value 
<emphasis remap='B'>%cert</emphasis>
will load the information required from a certificate defined in
<emphasis remap='B'>%leftcert</emphasis>
and automatically define leftid for you.
<emphasis remap='B'>Caution:</emphasis>
if two connection descriptions
specify different public keys for the same
<emphasis remap='B'>leftid</emphasis>,
confusion and madness will ensue.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftrsasigkey2</emphasis></term>
  <listitem>
<para>if present, a second public key.
Either key can authenticate the signature, allowing for key rollover.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftcert</emphasis></term>
  <listitem>
<para>If you are using 
<emphasis remap='B'>leftrsasigkey=%cert</emphasis>
this defines the certificate you would like to use. It should point to a X.509
encoded certificate file. If you do not specify a full pathname, by default it
will look in /etc/ipsec.d/certs.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftsendcert</emphasis></term>
  <listitem>
<para>This option configures when Openswan will send X.509 certificates to the remote
host. Acceptable values are 
<emphasis remap='B'>yes|always</emphasis>
(signifying that we should always send a certificate),
<emphasis remap='B'>ifasked</emphasis>
(signifying that we should send a certificate if the remote end asks for it), and
<emphasis remap='B'>no|never</emphasis>
(signifying that we will never send a X.509 certificate).
The default for this option is 
<emphasis remap='B'>ifasked</emphasis>
which may break compatibility with other vendor's IPSec implementations, such as
Cisco and SafeNet. If you find that you are getting errors about no ID/Key found,
you likely need to set this to
<emphasis remap='B'>always.</emphasis></para>
  </listitem>
  </varlistentry>

  <varlistentry>
  <term><emphasis remap='B'>leftxauthserver</emphasis></term>
  <listitem>
<para>Left is an XAUTH server. This can use PAM for authentication or md5 passwords
in <emphasis remap='I'>/etc/ipsec.d/passwd</emphasis>. These are additional credentials
to verify the user identity, and should not be confused with the XAUTH
<emphasis remap='B'>group secret</emphasis>, which is just a regular PSK defined in
<emphasis remap='I'>ipsec.secrets</emphasis>.  The other side of the connection
should be configured as <emphasis remap='B'>rightxauthclient</emphasis>. XAUTH
connections cannot rekey, so <emphasis remap='B'>rekey=no</emphasis> should be
specified in this conn.  For further details on how to compile and use XAUTH, see README.XAUTH.
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default). 
</para>
  </listitem>
  </varlistentry>

  <varlistentry>
  <term><emphasis remap='B'>leftxauthclient</emphasis></term>
  <listitem>
<para>Left is an XAUTH client. The xauth connection will have to be started
interactively and cannot be configured using <emphasis remap='B'>auto=start</emphasis>.
Instead, it has to be started from the commandline using 
<emphasis remap='I'>ipsec auto --up connname</emphasis>. You will then be prompted
for the username and password. To setup an XAUTH connection non-interactively, which
defeats the whole purpose of XAUTH, but is regularly requested by users, it is
possible to use a whack command - <emphasis remap='I'>ipsec whack  --name baduser --ipsecgroup-xauth --xauthname badusername --xauthpass password --initiate</emphasis>
The other side of the connection should be configured as <emphasis remap='B'>rightxauthserver</emphasis>.
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default).</para>
  </listitem>
  </varlistentry>


  <varlistentry>
  <term><emphasis remap='B'>leftmodecfgserver</emphasis></term>
  <listitem>
<para>Left is a Mode Config server. It can push network configuration to the client.
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default). 
</para>
  </listitem>
  </varlistentry>

  <varlistentry>
  <term><emphasis remap='B'>leftmodecfgclient</emphasis></term>
  <listitem>
<para>Left is a Mode Config client. It can receive network configuration from the server.
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default).</para>
  </listitem>
  </varlistentry>

  <varlistentry>
  <term><emphasis remap='B'>forceencaps</emphasis></term>
  <listitem>
<para>
In some cases, for example when ESP packets are filtered or when a broken
IPsec peer does not properly recognise NAT, it can be useful to force
RFC-3948 encapsulation.
<emphasis remap='B'>forceencaps=yes</emphasis> forces the NAT detection
code to lie and tell the remote peer that RFC-3948 encapsulation (ESP in UDP
port 4500 packets) is required. For this option to have any effect, the setup section option
<emphasis remap='B'>nat_traversal=yes</emphasis> needs to be set. 
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default).
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>dpddelay</emphasis></term>
  <listitem>
<para>Set the delay (in seconds) between Dead Peer Dectection
(RFC 3706) keepalives (R_U_THERE, R_U_THERE_ACK)
that are sent for this connection (default
<literal>30</literal>
seconds).  If dpdtimeout is set, but not dpddelay, dpddelay will be set
to the default.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>dpdtimeout</emphasis></term>
  <listitem>
<para>Set the length of time (in seconds) we will idle without hearing either an
R_U_THERE poll from our peer, or an R_U_THERE_ACK reply.  After this period
has elapsed with no response and no traffic, we will declare the peer dead,
and remove the SA (default
<literal>120</literal>
seconds).  If dpddelay is set, but not dpdtimeout, dpdtimeout will be set
to the default.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>dpdaction</emphasis></term>
  <listitem>
<para>When a DPD enabled peer is declared dead, what action should be taken.
<emphasis remap='B'>hold (default) means the eroute will be put into %hold status, while</emphasis>
<emphasis remap='B'>clear means the eroute and SA with both be cleared. dpdaction=clear is</emphasis>
really only usefull on the server of a Road Warrior config.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>modecfgpull</emphasis></term>
  <listitem>
<para>Pull the Mode Config network information from the server.
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default).
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>pfs</emphasis></term>
  <listitem>
<para>whether Perfect Forward Secrecy of keys is desired on the connection's
keying channel
(with PFS, penetration of the key-exchange protocol
does not compromise keys negotiated earlier);
Since there is no reason to ever refuse PFS, Openswan will allow a connection defined with
<emphasis remap='B'>pfs=no</emphasis> to use PFS anyway.
Acceptable values are
<emphasis remap='B'>yes</emphasis>
(the default)
and
<emphasis remap='B'>no</emphasis>.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>pfsgroup</emphasis></term>
  <listitem>
<para>PFS  group to be used if <emphasis remap='B'>pfs=yes</emphasis>, e.g. pfsgroup=modp1536

Because PFS group is not negotiated it is  single  valued
and  must  be previously coordinated with peer.  Possible
values are: modp1024,  modp1536, modp2048, modp3072 and modp4096. 
If not specified, it will use same DH group of phase1.

Default value is the same value as Phase1's DH group.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>aggrmode</emphasis></term>
  <listitem>
<para>Use Aggressive Mode instead of Main Mode. Aggressive Mode is less secure,
and vulnerable to Denial Of Service attacks. It is also vulnerable to brute force
attacks with software such as <emphasis remap='B'>ikecrack</emphasis>. It should
not be used, and it should especially not be used with XAUTH and group secrets (PSK).
If the remote system administrator insists on staying irresponsible, enable this option.</para>
<para>Aggressive Mode is further limited to only one proposal - there is no room for
negotation. Therefor it is mandatory for Aggressive Mode connections that both
<emphasis remap='B'>ike=</emphasis> and <emphasis remap='B'>esp=</emphasis> options are
specified with exactly one fully specified proposal.
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default).</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>keylife</emphasis></term>
  <listitem>
<para>how long a particular instance of a connection
(a set of encryption/authentication keys for user packets) should last,
from successful negotiation to expiry;
acceptable values are an integer optionally followed by
<emphasis remap='B'>s</emphasis>
(a time in seconds)
or a decimal number followed by
<emphasis remap='B'>m</emphasis>,
<emphasis remap='B'>h</emphasis>,
or
<emphasis remap='B'>d</emphasis>
(a time
in minutes, hours, or days respectively)
(default
<emphasis remap='B'>8.0h</emphasis>,
maximum
<emphasis remap='B'>24h</emphasis>).
Normally, the connection is renegotiated (via the keying channel)
before it expires.
The two ends need not exactly agree on
<emphasis remap='B'>keylife</emphasis>,
although if they do not,
there will be some clutter of superseded connections on the end
which thinks the lifetime is longer.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>rekey</emphasis></term>
  <listitem>
<para>whether a connection should be renegotiated when it is about to expire;
acceptable values are
<emphasis remap='B'>yes</emphasis>
(the default)
and
<emphasis remap='B'>no</emphasis>.
The two ends need not agree,
but while a value of
<emphasis remap='B'>no</emphasis>
prevents Pluto from requesting renegotiation,
it does not prevent responding to renegotiation requested from the other end,
so
<emphasis remap='B'>no</emphasis>
will be largely ineffective unless both ends agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>rekeymargin</emphasis></term>
  <listitem>
<para>how long before connection expiry or keying-channel expiry
should attempts to
negotiate a replacement
begin; acceptable values as for
<emphasis remap='B'>keylife</emphasis>
(default
<emphasis remap='B'>9m</emphasis>).
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>rekeyfuzz</emphasis></term>
  <listitem>
<para>maximum percentage by which
<emphasis remap='B'>rekeymargin</emphasis>
should be randomly increased to randomize rekeying intervals
(important for hosts with many connections);
acceptable values are an integer,
which may exceed 100,
followed by a `%'
(default set by
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>,
currently
<emphasis remap='B'>100%</emphasis>).
The value of
<emphasis remap='B'>rekeymargin</emphasis>,
after this random increase,
must not exceed
<emphasis remap='B'>keylife</emphasis>.
The value
<emphasis remap='B'>0%</emphasis>
will suppress time randomization.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>keyingtries</emphasis></term>
  <listitem>
<para>how many attempts (a whole number or <emphasis remap='B'>%forever</emphasis>) should be made to
negotiate a connection, or a replacement for one, before giving up
(default
<emphasis remap='B'>%forever</emphasis>).
The value <emphasis remap='B'>%forever</emphasis>
means &ldquo;never give up&rdquo; (obsolete: this can be written <literal>0</literal>).
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>ikelifetime</emphasis></term>
  <listitem>
<para>how long the keying channel of a connection (buzzphrase:  &ldquo;ISAKMP SA&rdquo;)
should last before being renegotiated;
acceptable values as for
<emphasis remap='B'>keylife</emphasis>
(default set by
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>,
currently
<emphasis remap='B'>1h</emphasis>,
maximum
<emphasis remap='B'>8h</emphasis>).
The two-ends-disagree case is similar to that of
<emphasis remap='B'>keylife</emphasis>.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>compress</emphasis></term>
  <listitem>
<para>whether IPComp compression of content is proposed on the connection
(link-level compression does not work on encrypted data,
so to be effective, compression must be done <emphasis remap='I'>before</emphasis> encryption);
acceptable values are
<emphasis remap='B'>yes</emphasis>
and
<emphasis remap='B'>no</emphasis>
(the default).
The two ends need not agree.
A value of
<emphasis remap='B'>yes</emphasis>
causes IPsec to propose both compressed and uncompressed,
and prefer compressed.
A value of
<emphasis remap='B'>no</emphasis>
prevents IPsec from proposing compression;
a proposal to compress will still be accepted.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>disablearrivalcheck</emphasis></term>
  <listitem>
<para>whether KLIPS's normal tunnel-exit check
(that a packet emerging from a tunnel has plausible addresses in its header)
should be disabled;
acceptable values are
<emphasis remap='B'>yes</emphasis>
and
<emphasis remap='B'>no</emphasis>
(the default).
Tunnel-exit checks improve security and do not break any normal configuration.
Relevant only locally, other end need not agree on it.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>failureshunt</emphasis></term>
  <listitem>
<para>what to do with packets when negotiation fails.
The default is
<emphasis remap='B'>none</emphasis>:
no shunt;
<emphasis remap='B'>passthrough</emphasis>,
<emphasis remap='B'>drop</emphasis>,
and
<emphasis remap='B'>reject</emphasis>
have the obvious meanings.</para>
  </listitem>
  </varlistentry>
</variablelist>
</refsect2>

<refsect2 id='conn_parameters__manual_keying'><title>CONN PARAMETERS:  MANUAL KEYING</title>
<para>The following parameters are relevant only to manual keying,
and are ignored in automatic keying. It is <emphasis remap='B'> EXTREMELY UNLIKELY</emphasis>
that you will actually want to use manual keying. It is <emphasis remap='B'>much</emphasis>
harder to configure then automatic keying, and <emphasis remap='B'>inheritently insecure</emphasis>
when used for a prolonged time (eg production) due to the complete lack of key renewal, session
keys or perfect forward secrecy.</para> 
<para>Unless otherwise noted, for a connection to work, in general it is necessary for the two
ends to agree exactly on the values of these parameters.  A manually-keyed
connection must specify at least one of AH or ESP.</para>
<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='B'>spi</emphasis></term>
  <listitem>
<para>(this or
<emphasis remap='B'>spibase</emphasis>
required for manual keying)
the SPI number to be used for the connection (see
<citerefentry><refentrytitle>ipsec_manual</refentrytitle><manvolnum>8</manvolnum></citerefentry>);
must be of the form <emphasis remap='B'>0x</emphasis><emphasis remap='I'>hex</emphasis><emphasis remap='B'></emphasis>,
where
<emphasis remap='I'>hex</emphasis>
is one or more hexadecimal digits
(note, it will generally be necessary to make
<emphasis remap='I'>spi</emphasis>
at least
<emphasis remap='B'>0x100</emphasis>
to be acceptable to KLIPS,
and use of SPIs in the range
<emphasis remap='B'>0x100</emphasis>-<emphasis remap='B'>0xfff</emphasis>
is recommended)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>spibase</emphasis></term>
  <listitem>
<para>(this or
<emphasis remap='B'>spi</emphasis>
required for manual keying)
the base number for the SPIs to be used for the connection (see
<citerefentry><refentrytitle>ipsec_manual</refentrytitle><manvolnum>8</manvolnum></citerefentry>);
must be of the form <emphasis remap='B'>0x</emphasis><emphasis remap='I'>hex</emphasis><literal>0</literal>,
where
<emphasis remap='I'>hex</emphasis>
is one or more hexadecimal digits
(note, it will generally be necessary to make
<emphasis remap='I'>spibase</emphasis>
at least
<emphasis remap='B'>0x100</emphasis>
for the resulting SPIs
to be acceptable to KLIPS,
and use of numbers in the range
<emphasis remap='B'>0x100</emphasis>-<emphasis remap='B'>0xff0</emphasis>
is recommended)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>espenckey</emphasis></term>
  <listitem>
<para>ESP encryption key
(must be suitable as a value of
<citerefentry><refentrytitle>ipsec_spi</refentrytitle><manvolnum>8</manvolnum></citerefentry>'s
<option>--enckey</option>
option)
(may be specified separately for each direction using
<emphasis remap='B'>leftespenckey</emphasis>
(leftward SA)
and
<emphasis remap='B'>rightespenckey</emphasis>
parameters)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>espauthkey</emphasis></term>
  <listitem>
<para>ESP authentication key
(must be suitable as a value of
<citerefentry><refentrytitle>ipsec_spi</refentrytitle><manvolnum>8</manvolnum></citerefentry>'s
<option>--authkey</option>
option)
(may be specified separately for each direction using
<emphasis remap='B'>leftespauthkey</emphasis>
(leftward SA)
and
<emphasis remap='B'>rightespauthkey</emphasis>
parameters)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>espreplay_window</emphasis></term>
  <listitem>
<para>ESP replay-window setting,
an integer from
<literal>0</literal>
(the
<emphasis remap='I'>ipsec_manual</emphasis>
default, which turns off replay protection) to
<literal>64</literal>;
relevant only if ESP authentication is being used</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftespspi</emphasis></term>
  <listitem>
<para>SPI to be used for the leftward ESP SA, overriding
automatic assignment using
<emphasis remap='B'>spi</emphasis>
or
<emphasis remap='B'>spibase</emphasis>;
typically a hexadecimal number beginning with
<emphasis remap='B'>0x</emphasis></para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>ahkey</emphasis></term>
  <listitem>
<para>(required if
<emphasis remap='B'>ah</emphasis>
is present) AH authentication key
(must be suitable as a value of
<citerefentry><refentrytitle>ipsec_spi</refentrytitle><manvolnum>8</manvolnum></citerefentry>'s
<option>--authkey</option>
option)
(may be specified separately for each direction using
<emphasis remap='B'>leftahkey</emphasis>
(leftward SA)
and
<emphasis remap='B'>rightahkey</emphasis>
parameters)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>ahreplay_window</emphasis></term>
  <listitem>
<para>AH replay-window setting,
an integer from
<literal>0</literal>
(the
<emphasis remap='I'>ipsec_manual</emphasis>
default, which turns off replay protection) to
<literal>64</literal></para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>leftahspi</emphasis></term>
  <listitem>
<para>SPI to be used for the leftward AH SA, overriding
automatic assignment using
<emphasis remap='B'>spi</emphasis>
or
<emphasis remap='B'>spibase</emphasis>;
typically a hexadecimal number beginning with
<emphasis remap='B'>0x</emphasis></para>
  </listitem>
  </varlistentry>
</variablelist>
</refsect2>
</refsect1>

<refsect1 id='config_sections'><title>CONFIG SECTIONS</title>
<para>At present, the only
<emphasis remap='B'>config</emphasis>
section known to the IPsec software is the one named
<emphasis remap='B'>setup</emphasis>,
which contains information used when the software is being started
(see
<citerefentry><refentrytitle>ipsec_setup</refentrytitle><manvolnum>8</manvolnum></citerefentry>).
Here's an example:</para>

<!-- .ne 8 -->
<literallayout remap='.nf'>
<!-- .ta 1c -->
<emphasis remap='B'>
config setup
	interfaces="ipsec0=eth1 ipsec1=ppp0"
	klipsdebug=none
	plutodebug=control
	nat_traversal=yes
	virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%4:172.16.0.0/12
</emphasis>
</literallayout> <!-- .fi -->

<para>Parameters are optional unless marked &ldquo;(required)&rdquo;.</para>

<para>The currently-accepted
<emphasis remap='I'>parameter</emphasis>
names in a
<emphasis remap='B'>config</emphasis>
<emphasis remap='B'>setup</emphasis>
section are:</para>

<variablelist remap='TP'>
  <varlistentry>
  <term><emphasis remap='B'>myid</emphasis></term>
  <listitem>
<para>the identity to be used for
<emphasis remap='B'>%myid</emphasis>.
<emphasis remap='B'>%myid</emphasis>
is used in the implicit policy group conns and can be used as
an identity in explicit conns.
If unspecified,
<emphasis remap='B'>%myid</emphasis>
is set to the IP address in <emphasis remap='B'>%defaultroute</emphasis> (if that is supported by a TXT record in its reverse domain), or otherwise
the system's hostname (if that is supported by a TXT record in its forward domain), or otherwise it is undefined.
An explicit value generally starts with ``<emphasis remap='B'>@</emphasis>''.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>interfaces</emphasis></term>
  <listitem>
<para>This option is for KLIPS and KLIPSNG (mast)  only and will be ignored
when using NETKEY, Windows or BSD stacks. It specifies the virtual and physical
interfaces for IPsec to use: a single
<emphasis remap='I'>virtual</emphasis><emphasis remap='B'>=</emphasis><emphasis remap='I'>physical</emphasis> pair, a (quoted!) list of pairs separated
by white space, or
<emphasis remap='B'>%none</emphasis>.
One of the pairs may be written as
<emphasis remap='B'>%defaultroute</emphasis>,
which means: find the interface <emphasis remap='I'>d</emphasis> that the default route points to,
and then act as if the value was ``<emphasis remap='B'>ipsec0=</emphasis><emphasis remap='I'>d</emphasis>''.
<emphasis remap='B'>%defaultroute</emphasis>
is the default;
<emphasis remap='B'>%none</emphasis>
must be used to denote no interfaces.
If
<emphasis remap='B'>%defaultroute</emphasis>
is used (implicitly or explicitly)
information about the default route and its interface is noted for
use by
<citerefentry><refentrytitle>ipsec_manual</refentrytitle><manvolnum>8</manvolnum></citerefentry>
and
<citerefentry><refentrytitle>ipsec_auto</refentrytitle><manvolnum>8</manvolnum></citerefentry>.)</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>nat_traversal</emphasis></term>
  <listitem>
<para>whether to accept/offer to support NAT (NAPT, also known as "IP Masqurade")
workaround for IPsec. Acceptable values are:
<emphasis remap='B'>yes</emphasis>
and
<emphasis remap='B'>no</emphasis>
(the default).
This parameter may eventually become per-connection.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>virtual_private</emphasis></term>
  <listitem>
<para>contains the networks that are allowed as subnet= for the remote
client. In other words, the address ranges that may live behind a NAT
router through which a client connects.  This value is usually set to
all the RFC-1918 address space, excluding the space used in the local
subnet behind the NAT (An IP address cannot live at two places at once).
IPv4 address ranges are denoted as
<emphasis remap='I'>%v4:a.b.c.d/mm</emphasis>
and IPv6 is denoted as
<emphasis remap='I'>%v6:aaaa::bbbb:cccc:dddd:eeee/mm</emphasis>. One
can exclude subnets by using the <emphasis remap='B'>!</emphasis>.
For example, if the VPN server is giving access to 192.168.1.0/24,
this option should be set to:
<emphasis remap='I'>virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%4:172.16.0.0/12,%v4:!192.168.1.0/24</emphasis>.
This parameter is only needed on the server side and not on the client side that resides behind the NAT router, as
the client will just use its IP address for the inner IP setting.
This parameter may eventually become per-connection.
</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>crlcheckinterval</emphasis></term>
  <listitem>
<para>interval, specified in seconds, after which pluto will verify
loaded X.509 CRL's for expiration. If any of the CRL's is expired, or
if they previously failed to get updated, a new attempt at updating the
CRL is made. The first attempt to update a CRL is started at two times
the crlcheckinterval. If set to <emphasis remap='B'>0</emphasis>, which
is also the default value if this option is not specified, CRL updating
is disabled.
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>strictcrlpolicy</emphasis></term>
  <listitem>
<para>if not set, pluto is tolerant about missing or expired X.509 Certificate
Revocation Lists (CRL's), and will allow peer certificates as long as they
do not appear on an expired CRL. When this option is enabled, all connections
with an expired or missing CRL will be denied. Active connections will be
terminated at rekey time. This setup is more secure, but also dangerous. If
the CRL is fetched through an IPsec tunnel with a CRL that expired, the
entire VPN server will be dead in the water until a new CRL is manually
transferred to the machine (if it allows non-IPsec connections).
Acceptable values are <emphasis remap='B'>yes</emphasis> or <emphasis remap='B'>no</emphasis>
(the default).
</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>forwardcontrol</emphasis></term>
  <listitem>
<para>whether
<emphasis remap='I'>setup</emphasis>
should turn IP forwarding on
(if it's not already on) as IPsec is started,
and turn it off again (if it was off) as IPsec is stopped;
acceptable values are
<emphasis remap='B'>yes</emphasis>
and (the default)
<emphasis remap='B'>no</emphasis>.
For this to have full effect, forwarding must be
disabled before the hardware interfaces are brought
up (e.g.,
<emphasis remap='B'>net.ipv4.ip_forward&nbsp;=&nbsp;0</emphasis>
in 
<filename>/etc/sysctl.conf</filename>),
because IPsec doesn't get control early enough to do that. If this option
is not specified, and subnet-subnet tunnels are configured, then IP
forwarding should be enabled by the system administrator.
</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>rp_filter</emphasis></term>
  <listitem>
<para>whether and how
<emphasis remap='I'>setup</emphasis>
should adjust the reverse path filtering mechanism for the
physical devices to be used.
Values are <emphasis remap='B'>%unchanged</emphasis> (to leave it alone)
or <literal>0</literal>, <literal>1</literal>, <literal>2</literal> (values to set it to).
<filename>/proc/sys/net/ipv4/conf/PHYS/rp_filter</filename>
is badly documented; it must be <literal>0</literal> in many cases
for ipsec to function.
The default value for the parameter is <literal>0</literal>, that is, to disable
rp_filter for all interfaces used.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>syslog</emphasis></term>
  <listitem>
<para>the
<citerefentry><refentrytitle>syslog</refentrytitle><manvolnum>2</manvolnum></citerefentry>
&ldquo;facility&rdquo; name and priority to use for
startup/shutdown log messages,
default
<emphasis remap='B'>daemon.error</emphasis>.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>klipsdebug</emphasis></term>
  <listitem>
<para>how much KLIPS debugging output should be logged.
An empty value,
or the magic value
<emphasis remap='B'>none</emphasis>,
means no debugging output (the default).
The magic value
<emphasis remap='B'>all</emphasis>
means full output.
Otherwise only the specified types of output
(a quoted list, names separated by white space) are enabled;
for details on available debugging types, see
<citerefentry><refentrytitle>ipsec_klipsdebug</refentrytitle><manvolnum>8</manvolnum></citerefentry>.
This KLIPS option has no effect on NETKEY, Windows or BSD stacks.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>plutodebug</emphasis></term>
  <listitem>
<para>how much Pluto debugging output should be logged.
An empty value,
or the magic value
<emphasis remap='B'>none</emphasis>,
means no debugging output (the default).
The magic value
<emphasis remap='B'>all</emphasis>
means full output.
Otherwise only the specified types of output
(a quoted list, names without the
<option>--debug-</option>
prefix,
separated by white space) are enabled;
for details on available debugging types, see
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>plutorestartoncrash</emphasis></term>
  <listitem>
<para>prevent pluto from restarting after it crashed. This option should only be used when a
post-mortem of a core file is desired. It prevents pluto from restarting and possibly overwriting 
an older core file.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>plutoopts</emphasis></term>
  <listitem>
<para>additional options to pass to pluto upon startup. See
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>plutostderrlog</emphasis></term>
  <listitem>
<para>do not use syslog, but rather log to stderr, and direct stderr to the
argument file.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>dumpdir</emphasis></term>
  <listitem>
<para>in what directory should things started by
<emphasis remap='I'>setup</emphasis>
(notably the Pluto daemon) be allowed to
dump core?
The empty value (the default) means they are not
allowed to.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>manualstart</emphasis></term>
  <listitem>
<para>which manually-keyed connections to set up at startup
(empty, a name, or a quoted list of names separated by white space);
see
<citerefentry><refentrytitle>ipsec_manual</refentrytitle><manvolnum>8</manvolnum></citerefentry>.
Default is none.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>pluto</emphasis></term>
  <listitem>
<para>whether to start Pluto or not;
Values are
<emphasis remap='B'>yes</emphasis>
(the default)
or
<emphasis remap='B'>no</emphasis>
(useful only in special circumstances).</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>plutowait</emphasis></term>
  <listitem>
<para>should Pluto wait for each
negotiation attempt that is part of startup to
finish before proceeding with the next?
Values are
<emphasis remap='B'>yes</emphasis>
or
<emphasis remap='B'>no</emphasis>
(the default).</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>prepluto</emphasis></term>
  <listitem>
<para>shell command to run before starting Pluto
(e.g., to decrypt an encrypted copy of the
<emphasis remap='I'>ipsec.secrets</emphasis>
file).
It's run in a very simple way;
complexities like I/O redirection are best hidden within a script.
Any output is redirected for logging,
so running interactive commands is difficult unless they use
<filename>/dev/tty</filename>
or equivalent for their interaction.
Default is none.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>postpluto</emphasis></term>
  <listitem>
<para>shell command to run after starting Pluto
(e.g., to remove a decrypted copy of the
<emphasis remap='I'>ipsec.secrets</emphasis>
file).
It's run in a very simple way;
complexities like I/O redirection are best hidden within a script.
Any output is redirected for logging,
so running interactive commands is difficult unless they use
<filename>/dev/tty</filename>
or equivalent for their interaction.
Default is none.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>fragicmp</emphasis></term>
  <listitem>
<para>whether a tunnel's need to fragment a packet should be reported
back with an ICMP message,
in an attempt to make the sender lower his PMTU estimate;
acceptable values are
<emphasis remap='B'>yes</emphasis>
(the default)
and
<emphasis remap='B'>no</emphasis>.
This KLIPS option has no effect on NETKEY, Windows or BSD stacks.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>hidetos</emphasis></term>
  <listitem>
<para>whether a tunnel packet's TOS field should be set to
<literal>0</literal>
rather than copied from the user packet inside;
acceptable values are
<emphasis remap='B'>yes</emphasis>
(the default)
and
<emphasis remap='B'>no</emphasis>.  This KLIPS option has no effect
on NETKEY, Windows or BSD stacks.</para>
  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>uniqueids</emphasis></term>
  <listitem>
<para>whether a particular participant ID should be kept unique,
with any new (automatically keyed)
connection using an ID from a different IP address
deemed to replace all old ones using that ID.
Acceptable values are <emphasis remap='B'>yes</emphasis>
(the default)
and
<emphasis remap='B'>no</emphasis>.
Participant IDs normally <emphasis remap='I'>are</emphasis> unique,
so a new (automatically-keyed) connection using the same ID is
almost invariably intended to replace an old one.</para>

  </listitem>
  </varlistentry>
  <varlistentry>
  <term><emphasis remap='B'>overridemtu</emphasis></term>
  <listitem>
<para>value that the MTU of the ipsec<emphasis remap='I'>n</emphasis> interface(s) should be set to,
overriding IPsec's (large) default.
This parameter is needed only in special situations.
This KLIPS option has no effect on NETKEY, Windows or BSD stacks.</para>

  </listitem>
  </varlistentry>
</variablelist>
</refsect1>

<refsect1 id='implicit_conns'><title>IMPLICIT CONNS</title>
<para>The system automatically defines several conns to implement
default policy groups. These are used to enable the establishing of
Opportunitic Encryption IPsec tunnels. That is, setting up IPsec tunnels
with peers you have no pre-arranged configuration with. Opportunistic
Encryption is currently only supported using the KLIPS or KLIPSNG (mast) stack,
and should not be enabled when using NETKEY, Windows or BSD stacks.</para>
<para> Each can be overridden by explicitly
defining a new conn with the same name.  If the new conn has <emphasis remap='B'>auto=ignore</emphasis>,
the definition is suppressed.</para>

<para>Here are the automatically supplied definitions.</para>

<!-- .ne 8 -->
<literallayout remap='.nf'>
<!-- .ta 1c -->
<emphasis remap='B'>
conn clear
	type=passthrough
	authby=never
	left=%defaultroute
	right=%group
	auto=route

conn clear-or-private
	type=passthrough
	left=%defaultroute
	leftid=%myid
	right=%opportunisticgroup
	failureshunt=passthrough
	keyingtries=3
	ikelifetime=1h
	keylife=1h
	rekey=no
	auto=route

conn private-or-clear
	type=tunnel
	left=%defaultroute
	leftid=%myid
	right=%opportunisticgroup
	failureshunt=passthrough
	keyingtries=3
	ikelifetime=1h
	keylife=1h
	rekey=no
	auto=route

conn private
	type=tunnel
	left=%defaultroute
	leftid=%myid
	right=%opportunisticgroup
	failureshunt=drop
	keyingtries=3
	ikelifetime=1h
	keylife=1h
	rekey=no
	auto=route

conn block
	type=reject
	authby=never
	left=%defaultroute
	right=%group
	auto=route

# default policy
conn packetdefault
	type=tunnel
	left=%defaultroute
	leftid=%myid
	left=0.0.0.0/0
	right=%opportunistic
	failureshunt=passthrough
	keyingtries=3
	ikelifetime=1h
	keylife=1h
	rekey=no
	auto=route
</emphasis>
</literallayout> <!-- .fi -->

<para>These conns are <emphasis remap='I'>not</emphasis> affected by anything in <emphasis remap='B'>conn %default</emphasis>.
They will only work if <emphasis remap='B'>%defaultroute</emphasis> works.
The <emphasis remap='B'>leftid</emphasis> will be the interfaces IP address; this
requires that reverse DNS records be set up properly.</para>

<para>The implicit conns are defined after all others.  It is
appropriate and reasonable to use <emphasis remap='B'>also=private-or-clear</emphasis>
(for example) in any other opportunistic conn.</para>
</refsect1>

<refsect1 id='policy_group_files'><title>POLICY GROUP FILES</title>
<para>The optional files under 
<filename>/etc/ipsec.d/policy</filename>,
including</para>
<literallayout remap='.nf'>

/etc/ipsec.d/policies/clear
/etc/ipsec.d/policies/clear-or-private
/etc/ipsec.d/policies/private-or-clear
/etc/ipsec.d/policies/private
/etc/ipsec.d/policies/block

</literallayout> <!-- .fi -->
<para>may contain policy group configuration information to 
supplement 
<emphasis remap='I'>ipsec.conf</emphasis>.
Their contents are not security-sensitive.</para>

<para>These files are text files.
Each consists of a list of CIDR blocks, one per line.
White space followed by # followed by anything to the end of the line
is a comment and is ignored, as are empty lines.</para>

<para>A connection in
<filename>/etc/ipsec.conf</filename>
which has
<emphasis remap='B'>right=%group</emphasis>
or 
<emphasis remap='B'>right=%opportunisticgroup</emphasis>
is a policy group connection.
When a policy group file of the same name is loaded, with</para>

<para>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<emphasis remap='B'>ipsec auto --rereadgroups</emphasis></para> 

<para>or at system start, the connection is instantiated such that each
CIDR block serves as an instance's 
<emphasis remap='B'>right</emphasis>
value. The system treats the
resulting instances as normal connections.</para>

<para>For example, given a suitable connection definition 
<emphasis remap='B'>private</emphasis>,
and the file
<filename>/etc/ipsec.d/policy/private</filename>
with an entry 192.0.2.3,
the system creates a connection instance 
<emphasis remap='B'>private#192.0.2.3.</emphasis>
This connection inherits all details from 
<emphasis remap='B'>private</emphasis>,
except that its right client is 192.0.2.3.</para>
</refsect1>

<refsect1 id='default_policy_groups'><title>DEFAULT POLICY GROUPS</title>
<para>The standard Openswan install includes several policy groups
which provide a way of classifying possible peers into IPsec security classes:
<emphasis remap='B'>private</emphasis>
(talk encrypted only),
<emphasis remap='B'>private-or-clear</emphasis>
(prefer encryption),
<emphasis remap='B'>clear-or-private</emphasis>
(respond to requests for encryption), 
<emphasis remap='B'>clear</emphasis>
and
<emphasis remap='B'>block</emphasis>.
Implicit policy groups apply to the local host only,
and are implemented by the
<emphasis remap='B'>IMPLICIT CONNECTIONS</emphasis>
described above.</para>
</refsect1>

<refsect1 id='choosing_a_connection'><title>CHOOSING A CONNECTION</title>
<para>When choosing a connection to apply to an outbound packet caught with a 
<emphasis remap='B'>%trap,</emphasis>
the system prefers the one with the most specific eroute that
includes the packet's source and destination IP addresses.
Source subnets are examined before destination subnets.
For initiating, only routed connections are considered. For responding,
unrouted but added connections are considered.</para>

<para>When choosing a connection to use to respond to a negotiation which
doesn't match an ordinary conn, an opportunistic connection
may be instantiated. Eventually, its instance will be /32 -&gt; /32, but
for earlier stages of the negotiation, there will not be enough
information about the client subnets to complete the instantiation.</para>
</refsect1>

<refsect1 id='files'><title>FILES</title>
<literallayout remap='.nf'>
/etc/ipsec.conf
/etc/ipsec.d/policies/clear
/etc/ipsec.d/policies/clear-or-private
/etc/ipsec.d/policies/private-or-clear
/etc/ipsec.d/policies/private
/etc/ipsec.d/policies/block
</literallayout> <!-- .fi -->
</refsect1>

<refsect1 id='see_also'><title>SEE ALSO</title>
<para><citerefentry><refentrytitle>ipsec</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>ipsec_ttoaddr</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>ipsec_auto</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>ipsec_manual</refentrytitle><manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>ipsec_rsasigkey</refentrytitle><manvolnum>8</manvolnum></citerefentry></para>
</refsect1>

<refsect1 id='history'><title>HISTORY</title>
<para>Designed for the FreeS/WAN project
&lt;<ulink url='http://www.freeswan.org'>http://www.freeswan.org</ulink>&gt;
by Henry Spencer.</para>
</refsect1>

<refsect1 id='bugs'><title>BUGS</title>
<para>When
<emphasis remap='B'>type</emphasis>
or 
<emphasis remap='B'>failureshunt</emphasis>
is set to
<emphasis remap='B'>drop</emphasis>
or
<emphasis remap='B'>reject,</emphasis>
Openswan blocks outbound packets using eroutes, but assumes inbound
blocking is handled by the firewall. Openswan offers firewall hooks 
via an &ldquo;updown&rdquo; script.  However, the default 
<emphasis remap='B'>ipsec _updown</emphasis>
provides no help in controlling a modern firewall.</para>

<para>Including attributes of the keying channel
(authentication methods,
<emphasis remap='B'>ikelifetime</emphasis>,
etc.)
as an attribute of a connection,
rather than of a participant pair, is dubious and incurs limitations.</para>

<para><emphasis remap='I'>Ipsec_manual</emphasis>
is not nearly as generous about the syntax of subnets,
addresses, etc. as the usual Openswan user interfaces.
Four-component dotted-decimal must be used for all addresses.
It
<emphasis remap='I'>is</emphasis>
smart enough to translate bit-count netmasks to dotted-decimal form.</para>

<para>It would be good to have a line-continuation syntax,
especially for the very long lines involved in
RSA signature keys.</para>

<para>The ability to specify different identities,
<emphasis remap='B'>authby</emphasis>,
and public keys for different automatic-keyed connections
between the same participants is misleading;
this doesn't work dependably because the identity of the participants
is not known early enough.
This is especially awkward for the &ldquo;Road Warrior&rdquo; case,
where the remote IP address is specified as
<literal>0.0.0.0</literal>,
and that is considered to be the &ldquo;participant&rdquo; for such connections.</para>

<para>In principle it might be necessary to control MTU on an
interface-by-interface basis,
rather than with the single global override that
<emphasis remap='B'>overridemtu</emphasis>
provides.</para>

<para>A number of features which <emphasis remap='I'>could</emphasis> be implemented in
both manual and automatic keying
actually are not yet implemented for manual keying.
This is unlikely to be fixed any time soon.</para>

<para>If conns are to be added before DNS is available,
<emphasis remap='B'>left=</emphasis><emphasis remap='I'>FQDN</emphasis>,
<emphasis remap='B'>leftnextop=</emphasis><emphasis remap='I'>FQDN</emphasis>,
and
<emphasis remap='B'>leftrsasigkey=%dnsonload</emphasis>
will fail.
<citerefentry><refentrytitle>ipsec_pluto</refentrytitle><manvolnum>8</manvolnum></citerefentry>
does not actually use the public key for our side of a conn but it
isn't generally known at a add-time which side is ours (Road Warrior
and Opportunistic conns are currently exceptions).</para>

<para>The <emphasis remap='B'>myid</emphasis> option does not affect explicit <emphasis remap='B'> ipsec auto --add</emphasis> or <emphasis remap='B'>ipsec auto --replace</emphasis> commands for implicit conns.</para>
</refsect1>
</refentry>

