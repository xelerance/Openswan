os:
  - linux
  - osx

language: c
compiler:
  - gcc

before_install:
  - "sudo apt-get update"

env:
  global:
    - BUILD_ARCH=amd64
  matrix:
    - BUILD_ARCH=i386
    - BUILD_ARCH=amd64

before_install:
  - uname -a
  - env | sort -f
  - if [ "$TRAVIS_OS_NAME" = linux ]; then sudo apt-get update; fi
  - if [ "$TRAVIS_OS_NAME" = osx ]; then brew update; fi

install:
  - "sudo apt-get install gcc-multilib"
  - if [ "$TRAVIS_OS_NAME" = linux ]; then sudo apt-get install flex bison libgmp-dev:${BUILD_ARCH} libgmp3-dev:${BUILD_ARCH}; fi
  - if [ "$TRAVIS_OS_NAME" = osx ]; then brew install libgmp flex bison; fi
  - "PATH=$HOME/bin:$PATH export PATH"
  - "echo WERROR=-Werror >Makefile.inc.local"
  - "echo ARCH=${BUILD_ARCH}   >>Makefile.inc.local"
  - if [ "$BUILD_ARCH" = i386 ]; then echo "CROSSCOMPILE=-m32" >>Makefile.inc.local; fi

script:
  - "cat Makefile.inc.local"
  - "make env | sort -f"
  - "make programs "
